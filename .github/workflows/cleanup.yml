name: Delete Old Workflow Runs

on:
  # Schedule to run once every night at 00:00 UTC (12 AM)
  schedule:
    - cron: '0 0 * * *'
  # Allows you to manually trigger the cleanup from the GitHub Actions tab
  workflow_dispatch:

jobs:
  delete_runs:
    runs-on: ubuntu-latest
    
    # ðŸ›‘ CRITICAL: This permission is mandatory for deleting runs
    permissions:
      actions: write
      contents: read # Also needed for the checkout step

    steps:
      - name: Checkout Repository (Optional but recommended)
        uses: actions/checkout@v4

      - name: Delete Old Workflow Runs
        uses: Mattra/delete-workflow-runs@v4
        with:
          # Your GitHub Token is automatically available
          token: ${{ github.token }}
          
          # Runs older than this many days will be deleted
          # (e.g., 30 days old runs will be deleted)
          retain_days: 100
          
          # Always keep at least this many of the newest runs for each workflow
          keep_minimum_runs: 5 
          
          # Optional: Specify a workflow name or filename to target.
          # Leave this out to target ALL workflows.
          # workflow: 'Ping D1 Links'
          
          # Optional: Run in dry-run mode first to confirm it works
          # Set to 'false' to perform the actual deletion!
          dry_run: false
