name: Delete Old Workflow Runs

on:
  # Schedule to run once every night at 00:00 UTC (12 AM)
  schedule:
    - cron: '0 0 * * *'
  # Allows you to manually trigger the cleanup from the GitHub Actions tab
  workflow_dispatch:

jobs:
  delete_runs:
    runs-on: ubuntu-latest
    
    # ðŸ›‘ CRITICAL: This permission is mandatory for deleting runs
    permissions:
      actions: write
      contents: read # Also needed for the checkout step

    steps:
      - name: Checkout Repository (Optional but recommended)
        uses: actions/checkout@v4

      - name: Delete Old Workflow Runs
        # --- CORRECTED LINE BELOW ---
        uses: Mattraks/delete-workflow-runs@v2 
        # Using v2 as it's the latest verified tag in the Marketplace
        with:
          # Your GitHub Token is automatically available
          token: ${{ github.token }}
          
          # Runs older than this many days will be deleted (e.g., 30 days old runs)
          retain_days: 30
          
          # Always keep at least this many of the newest runs for each workflow
          keep_minimum_runs: 5 
          
          # Set to 'true' to only log the runs that would be deleted.
          # Change to 'false' to perform the actual deletion!
          dry_run: false
